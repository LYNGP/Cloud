# netDisk项目

#### 介绍
1.基本功能：

 -     cd    进入服务器对应目录
 -     ls    列出服务器上相应的目录和文件
 -     pwd    显示目前所在路径
 -     puts filename    将本地文件上传至服务器当前的工作目录
 -     gets filename    从服务器的当前工作工作目录下载文件到本地
 -     rm filename     删除服务器上的某个文件
 -     mkdir dirname    创建空文件夹     
 -     rmdir dirname    删除文件夹(包括其内容)
 -     非法命令    不响应，并给出错误提示

2.用户系统:

-     用户登录和注册功能，登录过程中，密码通过密文传输；
-     服务器先传输salt值给客户端，客户端crypt加密后，传输密码个密文个服务器；

3.文件系统:

-     实现文件存储和文件元数据相分离，文件内容存储在服务器的文件系统中，文件的元数据信息存储在MySQL数据库中；
-     文件内容存储在文件系统中，每个文件的文件名是文件内容生成sha1sum，用于唯一标识文件内容；
-     文件元数据存储在虚拟文件表中，每个用户需要拥有自己独立的目录结构，每个用户只能看到自己上传的文件和创建的目录。

4.性能优化：

-     日志记录：服务器记录客户端请求信息和操作记录；
-     断点续传：支持文件从上次中断的地方开始传送数据，并非从文件开口传送；
-     文件传输优化：将文件映射(mmap)入内存，进行网络传递；
-     文件秒传：如果服务器的文件系统中存在要上传的文件，直接将文件信息写入数据库即可，不用进行上传操作；
-     实现长短命令分离：长命令(上传/下载，IO密集型)由线程池完成，其他命令(短命令，计算密集型)由主线程完成。客户端也创建单独的子线程用于长命令；
-     用户身份验证(token):服务器用其来区分不同的客户端；token由服务端在执行注册和登录命令时生成，并发送给客户端；以后每次客户端发送请求，必须先进行身份验证；
-     超时断开连接(时间轮实现)：维持一个循环队列，队列中每个节点指向一个文件描述符集合。每次超时时，就选择出踢出的文件描述符的集合




#### 安装教程


1.运行环境：

-         ubuntu18.04.1    
-         gcc7.5.0    
-         MySQL8.0.33    
-         redis6.0.8

2.运行前的准备工作

-     （1）安装MySQL开发库：
-         `sudo apt-get update`
-         ` sudo apt-get install libmysqlclient-dev`
-     （2）安装OpenSSL开发库
-         `sudo apt-get install libssl-dev`

3.创建数据库

-     (1)创建MySQL数据库，数据库名为netDisk;
-     (2)在netDisk中运行netDisk.sql的语句，创建两张表：user,file


#### 使用说明

1.  服务端的使用：进入server目录，在此目录下`make`即可，执行`./server 192.168.30.128 1234 5`即可运行服务端；其中./server为编译出的可执行程序，192.168.30.128为服务端绑定的IP,1234为端口号，5表示要创建线程池中，子线程的数目。
2.  客户端的使用：进入client目录，在此目录下`make`即可，执行`./client 192.168.30.128 1234`即可运行客户端；其中./client为编译出的可执行程序，192.168.30.128为服务端绑定的IP,1234为其端口号。


